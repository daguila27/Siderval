
<div id="up-fills" class="row up-fills" style="margin: 0; padding: 0; position: fixed; width: 100%; z-index: 10;">
    <div class="col-sm-12 o_control_panel" style="display: flex; margin: 0; padding: 10px; width: 100%; position: relative">
        <ol class="breadcrumb" style="width: 50%; padding: 10px 2px 0px 20px">
            <li class="active">Movimiento Bodega Materias Primas</li>
        </ol>
        <div style="width: 50%;">
            <div class="form-group o_searchview" style="margin: 0;padding: 0;">
                <div class="form-control etiqueta-input" style="display:flex; vertical-align: center">
                    <div class="etiqueta-filtro-div" style="height: 100%;" data-cant="0">
                    </div>
                    <input id="buscar_movimiento" style="border: none;" placeholder="Buscar…" type="text" onkeydown="despInput(event)">
                    <input id="buscar_movimiento-value" style="display: none" type="text">
                </div>
                <ul class="dropdown-menu o_searchview_autocomplete" data-item="0" role="menu" style="display: none;">
                    <li data-searchcol="0" class="item0 fill-item-abast o-selection-focus"><a class="o-expand" href="#"></a><a href="#">Buscar <em>Guías de Despacho</em> para: <strong></strong></a></li>
                    <li data-searchcol="1" class="item1 fill-item-abast"><a class="o-expand" href="#"></a><a href="#">Buscar <em>Descripción</em> para: <strong></strong></a></li>
                    <li data-searchcol="2" class="item2 fill-item-abast"><a class="o-expand" href="#"></a><a href="#">Buscar <em>Etapa</em> para: <strong></strong></a></li>
                    <li data-searchcol="3" class="item3 fill-item-abast"><a class="o-expand" href="#"></a><a href="#">Buscar <em>Movimiento</em> para: <strong></strong></a></li>
                    <li data-searchcol="4" class="item4 fill-item-abast"><a class="o-expand" href="#"></a><a href="#">Buscar <em>Receptor</em> para: <strong></strong></a></li>
                </ul>
            </div>
            <div class="btn-group btn-group-sm o_cp_switch_buttons" style="margin-top: 5px">
                <button type="button" accesskey="l" aria-label="list" data-view-type="list" title="" data-view='table_movimientos' class="btn btn-icon fa fa-lg fa-list-ul view-option active" data-original-title="Lista"></button>
                <div class="search-option-list" style="display: flex;"></div>
            </div>
        </div>
    </div>
</div>
<div id="fw-container" style="background-color: white; width: 100%; height: 100%;">
    <div id="fw-body"  style="padding:0;margin: 0;">
        <div class="content main-page">
        </div>
    </div>
</div>
<script type="text/javascript">
    var filtros_seleccionados = [];
    var array_fill = [
        "N°Mov@success",
        "Descripción@warning",
        "Etapa@default",
        "Movimiento@info",
        "Receptor@danger",
    ];
    $(document).ready(function(){
        $(".up-fills").css('margin-top', $("#oe_main_menu_navbar").outerHeight());

        $.ajax({
            type: 'POST',
            data:{ orden: 'movimiento_detalle.idmovimiento-DESC', clave: filtros_seleccionados.join(',')},
            beforeSend: function(){
                destroyDataTable();
            },
            url: '/matprimas/table_movimientos',
            success: function(data){
                $(".main-page").html(data);
                $("#fw-container").css('margin-top', $("#oe_main_menu_navbar").height()+$("#up-fills").height()-5);
            }
        });
        $(".row-main").css('padding-top', $(".o_control_panel").css('height') );
    });
    //PARA QUE EL FILTRO NO SE CIERRE AL SELECCIONAR ALGUNA OPCION
    $(document).on('click', '.fill_cc .dropdown-menu', function (e) {
        e.stopPropagation();
    });
    function buscar_movimiento(){
        $.ajax({
            type: 'POST',
            data:{ orden: 'movimiento_detalle.idmovimiento-DESC', clave: filtros_seleccionados.join(',')},
            beforeSend: function(){
                destroyDataTable();
            },
            url: '/matprimas/table_movimientos',
            success: function(data){
                $(".main-page").html(data);
            }
        });
    }


    $('.fill-item-abast').hover(function() {
        $(this).css('cursor','pointer');
        $('.fill-item-abast').removeClass("o-selection-focus");
        $(this).addClass("o-selection-focus");
        $(".o_searchview_autocomplete").data('item', $(this).data('searchcol'));
    });

    $("#buscar_movimiento").on('keyup', function(e){
        e.preventDefault();
        if($(this).val() == '' || $(this).val() == null || $(this).val()==undefined ){
            $(".o_searchview_autocomplete").css('display', 'none');
            $(".o_searchview_autocomplete strong").html('');
        }
        else{
            $(".o_searchview_autocomplete").css('display', 'block');
            $(".o_searchview_autocomplete strong").html($(this).val());

        }

    });

    $(".fill-item-abast").on('click', function(e){
        e.preventDefault();
        var clase = array_fill[parseInt($(this).data('searchcol'))].split('@');
        var labels = parseInt($(".etiqueta-filtro-div").data('cant'));
        $(".etiqueta-filtro-div").append(
            "<label id='label"+labels+"' data-valor='"+$(this).data('searchcol')+"@"+$("#buscar_movimiento").val()+"' class='etiqueta-filtro label label-"+clase[1]+"'>"+clase[0]+": <strong>"
            +$("#buscar_movimiento").val()+
            "</strong> <div onclick='eliminarEtiqueta(this)' class='fa fa-sm fa-remove etiqueta-filtro-del'></div></label>"
        );
        $(".etiqueta-filtro-div").data('cant', labels+1);
        if($("#buscar_movimiento-value").val() == '' || $("#buscar_movimiento-value").val() == null || $("#buscar_movimiento-value").val() == undefined){
            $("#buscar_movimiento-value").val($(this).data('searchcol')+"@"+$("#buscar_movimiento").val());
        }
        else{
            $("#buscar_movimiento-value").val([$("#buscar_movimiento-value").val(),$(this).data('searchcol')+"@"+$("#buscar_movimiento").val()].join(','));
        }
        filtros_seleccionados.push($(this).data('searchcol')+"@"+$("#buscar_movimiento").val());
        $(".o_searchview_autocomplete").css('display', 'none');
        $(".o_searchview_autocomplete strong").html('');
        $("#buscar_movimiento").val('');
        $("#buscar_movimiento").focus();
        buscar_movimiento();
    });


    function eliminarEtiqueta(yo){
        filtros_seleccionados.splice(filtros_seleccionados.indexOf($(yo).parent().data('valor')),1);
        $(yo).parent().remove();
        $(".etiqueta-filtro").removeAttr('id');
        var count = 0;
        $(".etiqueta-filtro").each(function(){
            $(this).attr("id","label"+count);
            count++;
        });
        $(".etiqueta-filtro-div").data('cant', $(".etiqueta-filtro-div").data('cant')-1);
        buscar_movimiento();
    }



    function despInput(event){
        var char = event.which || event.keyCode;
        var item = $(".o_searchview_autocomplete").data('item');
        //BORRAR LABEL
        if(char == 8 && ($("#buscar_movimiento").val()==null || $("#buscar_movimiento").val()=='' || $("#buscar_movimiento").val()==undefined ) &&  parseInt($(".etiqueta-filtro-div").data('cant')) > 0 ){
            var labels = parseInt($(".etiqueta-filtro-div").data('cant'))-1;
            eliminarEtiqueta($("#label"+labels).children('div'));
        }
        //ENTER
        else if(char == 13){
            $(".fill-item-abast.o-selection-focus").click();
        }
        //ARRIBA
        else if(char == 38){
            item = parseInt(item) - 1;
        }
        //ABAJO
        else if(char == 40){
            item = parseInt(item) + 1;
        }


        //SI SOBREPASA EL LIMITE INFERIOR
        if(parseInt(item) >= 5){
            $(".o_searchview_autocomplete").data('item', "0");
            $(".fill-item-abast").removeClass("o-selection-focus");
            $(".item0").addClass("o-selection-focus");
        }
        //SI SOBREPASA EL LIMITE SUPERIOR
        else if(parseInt(item) < 0){
            $(".o_searchview_autocomplete").data('item', "4");
            $(".fill-item-abast").removeClass("o-selection-focus");
            $(".item4").addClass("o-selection-focus");
        }
        else{
            $(".o_searchview_autocomplete").data('item', item);
            $(".fill-item-abast").removeClass("o-selection-focus");
            $(".item"+item).addClass("o-selection-focus");
        }

    }


    $('.view-option').on('click', function(e){
        e.preventDefault();
        $('.view-option').removeClass('active');
        $(this).addClass('active');
        if($(this).data('view') == 'table_movimientos'){
            $.ajax({
                type: 'POST',
                data: {orden: 'movimiento_detalle.idmovimiento-DESC', clave: $("#buscar_movimiento").val()},
                url: '/matprimas/table_movimientos',
                success: function(data){
                    $(".main-page").html(data);
                }
            });
        }

    });

    function fill_oda_cc(yo){
        $('.dropdown.open .dropdown_btn_ccfill').dropdown('toggle');
    }

    function change_mulselected(yo){
        var beforeCheck = $(yo).data('allbeforecheck');
        if($("#all_option_cc").is(':selected') && !beforeCheck){
            $(yo).data('allbeforecheck', 1);
            $(".option_multiple_select").prop("selected", true);
        }
        else if(!$("#all_option_cc").is(':selected')){
            $(yo).data('allbeforecheck', 0);
        }
    }



</script>